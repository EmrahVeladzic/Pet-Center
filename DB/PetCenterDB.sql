CREATE DATABASE [IB210162]
GO
USE [IB210162]
GO

CREATE SCHEMA [File]
GO
CREATE SCHEMA [Person]
GO
CREATE SCHEMA [Business]
GO
CREATE SCHEMA [Offer]
GO
CREATE SCHEMA [Pending]
GO


CREATE TABLE [File].[Album](
	ID INT IDENTITY(1,1) PRIMARY KEY
);
GO	
	
CREATE TABLE [File].[Image](
	ID INT IDENTITY(1,1) PRIMARY KEY,
	AlbumID INT FOREIGN KEY REFERENCES [File].[Album](ID),
	Width INT NOT NULL,
	Height INT NOT NULL,
	ImageData VARBINARY(MAX) NOT NULL
);
GO
	
CREATE TABLE [Person].[Account](
	ID INT IDENTITY(1,1) PRIMARY KEY,
	Contact VARCHAR(255) NOT NULL,
	PasswordHash VARCHAR(44) NOT NULL,
	PasswordSalt VARCHAR(24) NOT NULL,
	AccessLevel TINYINT NOT NULL,
	Verified BIT
);
GO

CREATE TABLE [Person].[User](
	ID INT IDENTITY(1,1) PRIMARY KEY,
	AccountID INT FOREIGN KEY REFERENCES [Person].[Account](ID) NOT NULL,
	UserName NVARCHAR(50) NOT NULL,
	ImageID INT FOREIGN KEY REFERENCES [File].[Image]
);
GO

CREATE TABLE [Business].[Franchise](
	ID INT IDENTITY(1,1) PRIMARY KEY,
	OwnerID INT FOREIGN KEY REFERENCES [Person].[User](ID) NOT NULL,
	FranchiseName NVARCHAR(50) NOT NULL,
	LogoID INT FOREIGN KEY REFERENCES [File].[Image](ID)
);
GO

CREATE TABLE [Business].[Facility](
	ID INT IDENTITY(1,1) PRIMARY KEY,
	FranchiseID INT FOREIGN KEY REFERENCES [Business].[Franchise](ID) NOT NULL,
	City NVARCHAR(100) NOT NULL,
	Street NVARCHAR(150) NOT NULL,
	Contact VARCHAR(30)
);
GO

CREATE TABLE [Offer].[Listing](
	ID INT IDENTITY(1,1) PRIMARY KEY,
	ListingName NVARCHAR(50) NOT NULL,
	ListingDescription NVARCHAR(500) NOT NULL,
	AlbumID INT FOREIGN KEY REFERENCES [File].[Album](ID) NOT NULL
);
GO

CREATE TABLE [Pending].[Registration](
	AccountID INT FOREIGN KEY REFERENCES [Person].[Account](ID) PRIMARY KEY,
	Code INT NOT NULL,
	Expiry DATETIME2 NOT NULL,
	NextAttempt DATETIME2 NOT NULL
);
GO

USE master 
GO

